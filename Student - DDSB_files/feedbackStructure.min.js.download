jQuery(function(e){"use strict";var a=window.console||e.noop;e.fn.feedbackForm=function(i){var s=e.extend(!0,{},t,i),d=e("<div>").addClass("ffLoadingContainer").html(s.loadingText),n=e("<div>").addClass("ffLogo"),l=e("<h1>").addClass("ffHeaderText"),o=e("<div>").addClass("ffFeedbackText"),r=e("<div>").addClass("ffOneToTenContainer"),p=e("<div>").addClass("numberRatingFeedbackValidationMessage").addClass("ffValidation"),f=-1,c=!1,u=e("<div>").addClass("ffCategoryText"),h=e("<div>").addClass("specificFeedbackValidationMessage").addClass("ffValidation"),m=e("<div>").addClass("ffSpecificContainer"),g=e("<ul>"),v=e("<div>").addClass("ffContactContainer"),b=e("<div>").addClass("ffAgreeTermsContainer"),C=e("<div>").addClass("contactValidationMessage").addClass("ffValidation"),k=e("<h2>").addClass("ffContactHeaderText"),T=e("<div>").addClass("ffContactFormDescriptionText"),x=e("<label for='ffFirstName'>").addClass("ffContactFieldLabel"),y=e("<label for='ffLastName'>").addClass("ffContactFieldLabel"),F=e("<label for='ffEmail'>").addClass("ffContactFieldLabel"),L=e("<label for='ffagreeTermsId'></label>").addClass("ffAgreeTermsLabel"),N=e("<div>").addClass("agreeTermsFeedbackValidationMessage").addClass("ffValidation"),w=e("<input id='ffFirstName'>").addClass("ffFirstName").addClass("ic-form-control").prop("type","text").prop("maxlength",s.firstNameLength.toString()).on("keyup",function(){e(this).val().length>s.firstNameLength&&e(this).val(e(this).val().substring(0,s.firstNameLength))}),M=e("<input id='ffLastName'>").addClass("ffLastName").addClass("ic-form-control").prop("type","text").prop("maxlength",s.lastNameLength.toString()).on("keyup",function(){e(this).val().length>s.lastNameLength&&e(this).val(e(this).val().substring(0,s.lastNameLength))}),S=e("<input id='ffEmail'>").addClass("ffEmail").addClass("ic-form-control").prop("type","text").prop("maxlength",s.emailLength.toString()).on("keyup",function(){e(this).val().length>s.emailLength&&e(this).val(e(this).val().substring(0,s.emailLength))}),U=e("<div>").addClass("ffFormGroup"),V=e("<div>").addClass("ffValidation"),I=e("<div id='reCAPTCHAField' class='g-recaptcha'>"),j=s.recaptchaSrc.concat(s.language),B=e("<script>").attr("src",j).attr("async",!0).attr("defer",!0),R=document.createElement("input");R.type="checkbox",R.name="ffagreeTermsName",R.value="ffagreeTermsValue",R.id="ffagreeTermsId",R.className="ffAgreeTermsCheckBox";var A=e("<div>").addClass("ffFeedbackClose").html(s.closeText).click(_),E=e("<button>").addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close").attr("type","button").attr("role","button").attr("title","Close").attr("tabindex","-1").click(_).html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span><span class='ui-button-text'>Close</span>"),Y=e("<div>").addClass("feedbackModal").addClass("container").attr("style","display:none;").attr("aria-live","alert").append(d).append(n).append(e("<form>").prop("role","form").append(e("<input>").prop("type","submit").attr("aria-hidden","true").attr("style","display:none;")).append(e("<div>").addClass("ffFormContainer").append(l).append(e("<div>").addClass("ffFormGroup").append(o).append(r).append(p)).append(e("<div>").addClass("clear")).append(u).append(m.append(g)).append(h).append(v).append(C).append(b).append(N).append(U).append(V)).append(e("<div>").addClass("button-group").append(A).append(e("<div>").addClass("ffFeedbackButton").click(function(){if(K(),function(){var a=!0;if(-1==f&&(p.append(s.ratingValidationMessage),a=!1),!0===c&&(R.checked||(N.append(s.termsValidationMessage),a=!1)),s.contactInfoRequired){var t=!w.is(":visible")||w.val(),i=!M.is(":visible")||M.val(),d=!S.is(":visible")||S.val();t&&i&&d||(C.append(s.contactValidationMessage),a=!1)}if(s.requireCaptcha){var n=e(".g-recaptcha").length-1;""==grecaptcha.getResponse(n)&&(V.append("Please verify your feedback by clicking the reCAPTCHA checkbox."),a=!1)}return a}()){var a=0===m.find("textarea:visible").length?"":m.find("textarea:visible").val();s.previewMode||e.ajax({url:s.baseUrl+s.postUrl,data:"data="+encodeURIComponent('{"firstName":"'+W(w.val())+'","lastName":"'+W(M.val())+'","email":"'+W(S.val())+'","comments":"'+W(a)+'","rating":"'+f+'","category":"'+W(g.find("li.ui-tabs-active a").text())+'","pageTitle":"'+W(jQuery.trim(s.pageTitle))+'","browserResolution":"'+e(window).width()+"x"+e(window).height()+'","pageUrl":"'+W(document.URL.split("?")[0])+'"}'),contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"jsonp"}),_(),D.dialog({autoOpen:!1,width:s.thankYouModalWidth,modal:!0}).dialog("open"),e("div.feedbackModalThankyou").closest("div.ui-dialog").find(".ui-dialog-titlebar").hide(),e(".ui-dialog-titlebar-close").blur()}}).append(e("<div>").addClass("ffButtonLeft")).append(e("<div>").addClass("ffButtonMiddle").html(s.sendText)).append(e("<div>").addClass("ffButtonRight"))))),q=e("<h1>").addClass("ffThankYouTextHeader"),H=e("<button>").addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close").attr("type","button").attr("role","button").attr("title","Close").click(G).html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span><span class='ui-button-text'>Close</span>"),P=e("<p>").addClass("ffThankYouFormDescription"),D=e("<div>").addClass("feedbackModalThankyou").attr("title",s.thankYouModalTitle).attr("style","display:none;").append(q).append(H).append(P).append("<br /><br />").append(e("<div>").addClass("button-group").append(e("<div>").addClass("ffFeedbackButton").click(G).append(e("<div>").addClass("ffButtonLeft")).append(e("<div>").addClass("ffButtonMiddle").html(s.closeThankYouText)).append(e("<div>").addClass("ffButtonRight"))));s.showButton&&(this.filter("div").each(function(){e(this).addClass("feedbackTabButton").show().click(Q).html(e("<div>").html(s.buttonText))}),this.filter("a").each(function(){e(this).addClass("feedbackTabButton").show().click(Q)}),this.filter("body").each(function(){e(this).prepend(e("<div>").addClass("feedbackTabButton").addClass("ffDefaultTab").click(Q).append(e("<div>").html(s.buttonText)))})),s.feedbackFormId=e.trim(s.feedbackFormId.toString()),""!==s.feedbackFormId&&(s.getUrl="/form/"+s.feedbackFormId+"/definition",s.postUrl="/form/"+s.feedbackFormId+"/response"),b.hide();return e("head").append(B),0===s.baseUrl.indexOf("//")?s.baseUrl="https:"+s.baseUrl:s.baseUrl=s.baseUrl.replace(/^http:\/\//i,"https://"),e.ajax({url:s.baseUrl+s.getUrl,contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"jsonp",success:function(t){var i=t.length>0?t[0]:t;if(i&&i.fields){var h;i.fields.logo=(i.fields.logo||"").replace("http:",window.location.protocol),s.contactInfoRequired=i.fields.contactInfoRequired,s.agreementTerms=i.fields.agreementTerms,""!==s.skin&&void 0!==s.skin||(s.skin=O("skin",i.fields.skinBaseUrl).toString()),""!==s.skinVersion&&void 0!==s.skinVersion||(s.skinVersion=O("version",i.fields.skinBaseUrl).toString()),s.agreementTerms&&(h=s.agreementTerms)&&(L.append(h),b.show(),b.append(R),b.append(L),c=!0),s.feedbackFormId=i.id,s.getUrl="/form/"+i.id.toString()+"/definition",s.postUrl="/form/"+i.id.toString()+"/response";var C=s.jsServerUrl+"/skins/"+s.skin+"/"+s.skinVersion+"/styles/feedback.min.css";if(document.createStyleSheet)document.createStyleSheet(C);else{var N=document.createElement("link");N.type="text/css",N.rel="stylesheet",N.href=C,e("head").append(N)}var V=100,j=i.fields.ratings.length;j>0&&(V=Math.floor(100/j));var B=100;(j=i.fields.categories.length)>0&&(B=Math.floor(100/j));var A=0;e(i.fields.categories).each(function(){A++,g.append("<li style='width:"+B+"%'><a href='#ff-tabs-"+A+"'>"+this.title+"</a></li>"),m.append(e("<div>").attr("id","ff-tabs-"+A).append(e("<label for='ff-tabs-txt-"+A+"'>").append(e("<h2>").html(this.title))).append(e("<p>").addClass("ffSpecificDescription").html(this.instruction)).append(e("<textarea id='ff-tabs-txt-"+A+"'>").addClass("ffSuggestionField").addClass("ic-form-control").attr("maxlength",s.suggestionLength).on("keyup",function(){e(this).val().length>s.suggestionLength&&e(this).val(e(this).val().substring(0,s.suggestionLength))})))}),i.fields.ratings.sort(function(e,a){return(e.rank||0)-(a.rank||0)}),e(i.fields.ratings).each(function(){var a=this.rank;r.append(e("<div>").attr("style","width:"+V+"%").click(function(){f=a,r.find("div").removeClass("selected"),p.html(""),e(this).addClass("selected")}).addClass("ffRecommendButton").addClass("ItemSelectArea").html(this.title))}),m.tabs({collapsible:!0,active:!1}),n.append('<img src="'+i.fields.logo+'" ng-src="'+i.fields.logo+'" alt="'+i.logoAltText+'" class="img-responsive">'),n.append(E),l.empty().append(i.fields.headerText),o.append(i.fields.feedbackText),k.append(i.fields.contactHeaderText),T.append(i.fields.contactFormDescriptionText),u.append(i.fields.categoryText),x.html(s.firstNameText),y.html(s.lastNameText),F.append(s.emailText),q.append(i.fields.thankYouTextHeader),P.append(i.fields.thankYouFormDescription),(i.fields.askForFirstName||i.fields.askForLastName||i.fields.askForEmail)&&(v.append(k),""!==T.html()&&v.append(T)),void 0!==i.fields.askForFirstName&&i.fields.askForFirstName&&(v.append(x),v.append(w)),void 0!==i.fields.askForLastName&&i.fields.askForLastName&&(v.append(y),v.append(M)),void 0!==i.fields.askForEmail&&i.fields.askForEmail&&(v.append(F),v.append(S)),!0===i.fields.requireCaptcha&&U.append("<br>").append(I),s.siteKey=i.fields.recaptchaSiteKey,s.requireCaptcha=i.fields.requireCaptcha,d.hide()}else a.log("Failed to obtain feedback form definition")}}).error(function(e,t,i){"timeout"==t&&a.log("The server is not responding"),"error"==t&&a.log(i)}),s.showButton||Q(),this;function O(e,a){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(a);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function W(e){return e.replace(/(?:\r\n|\r|\n)/g," ").replace(/"/g,'\\"')}function K(){p.html(""),h.html(""),C.html(""),N.html(""),V.html("")}function Q(a){void 0!==a&&a.preventDefault(),Y.dialog({autoOpen:!1,width:s.formModalWidth,modal:!0}).dialog("open"),e("#ffFirstName").val(""),e("#ffLastName").val(""),e("#ffEmail").val(""),e(".ffSpecificContainer").find("textarea:visible").val(""),e(".ffOneToTenContainer").find("div").removeClass("selected"),K(),e("div.feedbackModal").closest("div.ui-dialog").find(".ui-dialog-titlebar").hide(),e(".ui-dialog-titlebar-close").blur();var t=0==e("#reCAPTCHAField").children().length;if(s.requireCaptcha&&t){grecaptcha.render("reCAPTCHAField",{sitekey:s.siteKey});var i=1;e("input,select,textarea").each(function(){"hidden"!=this.type&&(e(this).attr("tabindex",i),i++)})}}function _(){Y.dialog("close"),grecaptcha.reset(),e("#ffagreeTermsId").prop("checked",!1)}function G(){K(),D.dialog("close")}};var t={useDefaultIfNoIdIsSet:!0,baseUrl:"http://icreate-stg.esolutionsgroup.ca/feedback/api/1.0/",getUrl:"client/239000_97_201_iCreateTemplate/default-form/en",postUrl:"",jsServerUrl:"http://js.esolutionsgroup.ca/js/libs/feedback-form/",skin:"",skinVersion:"",previewMode:!1,contactInfoRequired:!1,agreementTerms:"",feedbackFormLoaded:!1,showButton:!0,buttonText:"Feedback",feedbackFormId:"",pageTitle:"",loadingText:"Please wait while this form loads...",firstNameLength:63,lastNameLength:63,emailLength:255,firstNameText:"First Name:",lastNameText:"Last Name:",emailText:"Email:",suggestionLength:512,closeText:"Or cancel",sendText:"Send Feedback",closeThankYouText:"Close",thankYouModalTitle:"Thank you for your feedback!",language:"en",ratingValidationMessage:"Please select a rating.",termsValidationMessage:"Please agree to the rules of contacting us.",contactValidationMessage:"Please provide your contact information.",thankYouModalWidth:600,formModalWidth:600,recaptchaSrc:"https://www.google.com/recaptcha/api.js?hl="}}(jQuery));
